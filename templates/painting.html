<html>
  <head>
    <title>Paint Something</title>
    <!-- temporary styling -->
    <style type="text/css">
      canvas {
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <div id="header">
      <h1>{{ word }}</h1>
    </div>
    <!-- The dimensions of the canvas must be set explicitly, can't use %, otherwise it will look blurry and not work -->
    <canvas id="canvas" width="600" height="400"></canvas>
    <div id="button-panel">
      Color: <input type="color" id="myColor">
      <!-- maybe add some divs here that control the color of the brush,
           and each div is the background color which it will change the brush tp -->
    </div>
    <form action="/draw/submit" method="POST" id="done">
      <input type="hidden" name="word" value="{{ word }}">
      <input type="submit" value="Submit Drawing">
      <!-- When the button is pressed, JS will use ninja powers to attach an <input type=hidden>
           to the form. It will be called "image" and contain canvas data as a string -->
    </form>
    <script type="text/javascript">
      //Important Variables~~~~~~~~~~~~~~~~~~~~~~~~~
      var canvas = document.getElementById("canvas");
      var form = document.getElementById("done");
      var ctx = canvas.getContext("2d");
      var mousedown = false;
      var color = document.getElementById("myColor").value;
      //Event Listeners~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      canvas.addEventListener("mousemove", function(event) {
        if(mousedown == true) {
          color = document.getElementById("myColor").value;
          changeColor(color);
          var x1 = event.offsetX, y1 = event.offsetY;
          var x0 = x1 - 2 * event.movementX, y0 = y1 - 2 * event.movementY;
          console.log(event.button, event.buttons);
          ctx.beginPath();
          ctx.moveTo(x0, y0);
          ctx.lineTo(x1, y1);
          ctx.stroke();
        }
      });
      canvas.addEventListener("mousedown", function(event) {
        mousedown = true;
      });
      canvas.addEventListener("mouseup", function(event) {
        mousedown = false;
      });
      done.addEventListener("submit", function(event) {
        var savedImage = document.createElement("input");
        savedImage.setAttribute("type", "hidden");
        savedImage.setAttribute("name", "image");
        savedImage.setAttribute("value", getImage());
        form.appendChild(savedImage);
      });
      //Useful functions~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      var startOver = function() {
        ctx.clearRect();
      }
      var changeThickness = function(t) {
        ctx.lineWidth = t;
        return t;
      }
      var changeColor = function(c) {
        ctx.strokeStyle = c;
        return c;
      }
      var getImage = function() {
        return canvas.toDataURL("image/png");
      }
      var setBackground = function(color) {
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      //Setup~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      changeColor("#000");
      changeThickness(5);
      console.log(getImage());
    </script>
  </body>
</html>
